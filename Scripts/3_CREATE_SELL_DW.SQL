CREATE DATABASE SELL_DW
GO

USE SELL_DW
GO

CREATE TABLE DIM_CUSTOMERS
(
	CUSTOMER_IDSK int primary key identity,
	CUSTOMER_ID bigint NULL,
	CUSTOMER_CREATED_AT datetime NULL,
	SCD_START_DATE DATETIME,
	SCD_END_DATE DATETIME,
)
GO

CREATE TABLE DIM_CURRENCY_CODES
(
	CURRENCY_CODE_ID int primary key,
	CURRENCY_CODE_NAME varchar(3) NULL
)
GO

CREATE TABLE DIM_FULFILLMENT_STATUS
(
	FULFILLMENT_STATUS_ID int primary key,
	FULFILLMENT_STATUS_NAME varchar(20) NULL
)
GO


CREATE TABLE DIM_TIME( 
    TIME_IDSK int primary key identity, 
    TIME_DATE date, 
    TIME_DAY char(2), 
    TIME_DAY_WEEK varchar(10), 
    TIME_MONTH char(2), 
    TIME_MONTH_NAME varchar(10), 
    TIME_QUARTER tinyint, 
    TIME_QUARTER_NAME varchar(10), 
    TIME_YEAR char(4), 
	TIME_SEASON_YEAR varchar(20),
	TIME_WEEKEND char(3),
	TIME_COMPLETE_DATE varchar(10)
) 
GO 

CREATE TABLE DIM_ORDERS
(
	ORDER_ID bigint primary key,
	ORDER_CREATED_TIME_IDSK int references DIM_TIME(TIME_IDSK),
	CURRENCY_CODE_ID int references DIM_CURRENCY_CODES(CURRENCY_CODE_ID),
	ORDER_SUBTOTAL numeric(10, 2) NULL,
	ORDER_TOTAL numeric(10, 2) NULL,
	FULFILLMENT_STATUS_ID int references DIM_FULFILLMENT_STATUS(FULFILLMENT_STATUS_ID),
	ORDER_CUSTOMER_ID int references DIM_CUSTOMERS(CUSTOMER_IDSK),
	CUSTOMER_CREATED_TIME_IDSK  int references DIM_TIME(TIME_IDSK)
)
GO


CREATE TABLE DW_FACT_GA
(
	GA_DATE date NULL,
	GA_ENTRANCES int NULL,
	GA_LANDING_PAGE text NULL,
	GA_SESSIONS int NULL,
	GA_BOUNCES int NULL,
	GA_CLICKS int NULL,
	GA_IMPRESSIONS int NULL,
	GA_TIME_ON_PAGE numeric(10, 2) NULL,
	GA_PAGEVIEWS int NULL,
	GA_EXITS int NULL,
	GA_URL_CLEAR varchar(200) null,
	GA_CATEGORY varchar(200) null,
	GA_VALUE varchar(200) null
)
GO

SELECT        st.CUSTOMER_ID, st.CUSTOMER_CREATED_AT
FROM            ST_CUSTOMERS AS st LEFT OUTER JOIN
                         SELL_DW.dbo.DIM_CUSTOMERS AS dw ON st.CUSTOMER_ID = dw.CUSTOMER_ID AND st.CUSTOMER_CREATED_AT = dw.CUSTOMER_CREATED_AT
WHERE        (dw.CUSTOMER_ID IS NULL)
